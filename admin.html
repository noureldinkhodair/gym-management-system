<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gym Admin Dashboard</title>
  <style>
    :root {
      --bg: #121212;
      --panel: #222222;
      --muted: #393939;
      --accent: #ffd600;
      --text: #ffffff;
      --muted-text: #bbbbbb;
    }
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    .container { display: flex; min-height: 100vh; }
    .sidebar {
      width: 250px;
      background: #1f1f1f;
      padding: 20px;
      box-sizing: border-box;
      border-right: 1px solid #0f0f0f;
    }
    .sidebar h2 {
      color: var(--accent);
      margin: 0 0 18px;
      font-size: 20px;
    }
    .sidebar ul { list-style: none; padding: 0; margin: 0; }
    .sidebar ul li { margin: 10px 0; }
    .sidebar a {
      color: #fff;
      text-decoration: none;
      display: block;
      padding: 8px;
      border-radius: 6px;
    }
    .sidebar a.active,
    .sidebar a:hover {
      background: var(--accent);
      color: #222;
    }
    .top-bar {
      position: fixed;
      left: 250px;
      right: 0;
      top: 0;
      height: 64px;
      background: #1f1f1f;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 0 18px;
      z-index: 100;
      border-bottom: 1px solid #0f0f0f;
    }
    .top-bar .left {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: bold;
      color: var(--accent);
      font-size: 18px;
      text-transform: capitalize;
    }
    .top-bar input[type="text"] {
      width: 360px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid var(--accent);
      background: #171717;
      color: #fff;
    }
    .top-bar .icons {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .main-content {
      margin-left: 250px;
      margin-top: 80px;
      padding: 26px;
      box-sizing: border-box;
    }
    .section { display: none; }
    .section.active { display: block; }
    h1 { margin: 0 0 14px; color: var(--accent); }
    .card-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 16px;
      margin-bottom: 18px;
    }
    .card {
      background: var(--panel);
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      border: 1px solid #111;
    }
    .card h3 { margin: 0 0 8px; font-size: 14px; color: var(--muted-text); }
    .card p { margin: 0; font-size: 20px; font-weight: bold; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      background: transparent;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid var(--muted);
      text-align: left;
      vertical-align: middle;
      font-size: 14px;
    }
    th { color: var(--muted-text); font-weight: 600; font-size: 13px; }
    .small-btn {
      padding: 6px 10px;
      border-radius: 8px;
      background: #1976d2;
      color: #fff;
      border: none;
      cursor: pointer;
      margin-right: 6px;
      font-size: 13px;
    }
    .small-btn:hover { background: var(--accent); color: #222; }
    .icon-btn {
      background: none; border: none; color: #fff;
      cursor: pointer; font-size: 16px; padding: 6px;
    }
    .modal {
      display: none;
      position: fixed;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.55);
      align-items: center;
      justify-content: center;
      z-index: 200;
    }
    .modal .modal-content {
      background: var(--panel);
      padding: 18px;
      border-radius: 8px;
      width: 92%; max-width: 820px;
      color: var(--text);
      box-shadow: 0 6px 30px rgba(0,0,0,0.6);
      border: 1px solid #111;
    }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }
    .form-grid label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
      color: var(--muted-text);
    }
    .form-grid input,
    .form-grid select {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid var(--accent);
      background: #171717;
      color: #fff;
      width: 100%;
      box-sizing: border-box;
    }
    .actions { display: flex; gap: 8px; margin-top: 12px; }
    .info-list { margin-top: 12px; display: grid; gap: 8px; }
    .info-row { display: flex; gap: 12px; align-items: center; }
    .info-label {
      min-width: 160px;
      color: var(--muted-text);
      font-size: 13px;
    }
    .info-value {
      background: #111;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #222;
      color: #ddd;
      flex: 1;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .date-field {
      position: relative;
      display: flex;
      align-items: center;
    }
    .date-field input[type="date"] {
      padding-right: 30px;
      flex: 1;
    }
    .date-field-icon {
      position: absolute;
      right: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    @media (max-width: 880px) {
      .top-bar input[type="text"] { width: 200px; }
      .sidebar { width: 200px; }
      .top-bar { left: 200px; }
      .main-content { margin-left: 200px; }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="sidebar">
    <h2>Gym Admin</h2>
    <ul>
      <li><a href="#" data-section="dashboard" class="active">Dashboard</a></li>
      <li><a href="#" data-section="members">Members</a></li>
      <li><a href="#" data-section="staff">Staff</a></li>
      <li><a href="#" data-section="trainers">Trainers</a></li>
      <li><a href="#" data-section="classes">Classes</a></li>
      <li><a href="#" data-section="payments">Payments</a></li>
      <li><a href="#" data-section="equipment">Equipment</a></li>
      <li><a href="#" data-section="gyms">Gyms</a></li>
      <li><a href="#" data-section="subscriptions">Subscriptions</a></li>
      <li><a href="#" data-section="member_benefits">Member Benefits</a></li>
      <li><a href="#" data-section="messages">Messages</a></li>
    </ul>
  </div>

  <div class="top-bar">
    <div class="left" id="top-title">Dashboard</div>
    <input type="text" id="search-input" placeholder="Search by ID or Name" />
    <button class="small-btn" onclick="performSearch()">Search</button>
    <div class="icons">
      <button class="icon-btn" onclick="goHome()">üè†</button>
    </div>
  </div>

  <div class="main-content">
    <div class="section active" id="dashboard">
      <h1>Dashboard Overview</h1>
      <div class="card-row">
        <div class="card">
          <h3>Total Members</h3>
          <p id="total-members">0</p>
        </div>
        <div class="card">
          <h3>Total Payments</h3>
          <p id="total-payments">0</p>
        </div>
        <div class="card">
          <h3>Total Trainers</h3>
          <p id="total-trainers">0</p>
        </div>
        <div class="card">
          <h3>Total Classes</h3>
          <p id="total-classes">0</p>
        </div>
        <div class="card">
          <h3>Total Staff</h3>
          <p id="total-staff">0</p>
        </div>
        <div class="card">
          <h3>Total Equipment</h3>
          <p id="total-equipment">0</p>
        </div>
      </div>
      <p style="color:var(--muted-text); margin-top:8px;">
        Use each section's Info button to view hidden fields (read-only).
      </p>
    </div>

    
  <div class="section" id="members">
  <h1>Members</h1>
  <button class="small-btn" onclick="showAddMember()">Add Member</button>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Age</th>
        <th>Gym ID</th>
        <th>Membership</th>
        <th>Start Date</th>
        <th>End Date</th>
        <th>Email</th>          
        <th>Phone</th>          
        <th>ID</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="members-tbody"></tbody>
  </table>
</div>


    <div class="section" id="staff">
      <h1>Staff</h1>
      <button class="small-btn" onclick="showAddStaff()">Add Staff</button>
      <table>
        <thead>
        <tr>
          <th>Staff ID</th>
          <th>Name</th>
          <th>Role</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Start Date</th>
          <th>Salary</th>
          <th>Gym ID</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody id="staff-tbody"></tbody>
      </table>
    </div>

    <div class="section" id="trainers">
      <h1>Trainers</h1>
      <button class="small-btn" onclick="showAddTrainer()">Add Trainer</button>
      <table>
        <thead>
        <tr>
           <th>ID</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Start Date</th>
          <th>Salary</th>
          <th>Gym ID</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody id="trainers-tbody"></tbody>
      </table>
    </div>

    <div class="section" id="classes">
  <h1>Classes</h1>
  <button class="small-btn" onclick="showAddClass()">Add Class</button>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Trainer</th>
        <th>Gym ID</th>
        <th>Time</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="classes-tbody"></tbody>
  </table>
</div>


    <div class="section" id="payments">
      <h1>Payments</h1>
      <button class="small-btn" onclick="showAddPayment()">Add Payment</button>
      <table>
        <thead>
        <tr>
           <th>ID</th>
          <th>Member</th>
          <th>Amount</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody id="payments-tbody"></tbody>
      </table>
    </div>

    <div class="section" id="equipment">
  <h1>Equipment</h1>
  <button class="small-btn" onclick="showAddEquipment()">Add Equipment</button>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Type</th>
        <th>Status</th>
        <th>Purchase Date</th>
        <th>Gym ID</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="equipment-tbody"></tbody>
  </table>
</div>

    <div class="section" id="gyms">
      <h1>Gyms</h1>
      <button class="small-btn" onclick="showAddGym()">Add Gym</button>
      <table>
        <thead>
        <tr>
          <th>Gym ID</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody id="gyms-tbody"></tbody>
      </table>
    </div>

    <div class="section" id="subscriptions">
      <h1>Subscriptions</h1>
      <button class="small-btn" onclick="showAddSubscription()">Add Subscription</button>
      <table>
        <thead>
        <tr>
          <th>Subscription ID</th>
          <th>Name</th>
          <th>Price</th>
          <th>Freeze Days</th>
          <th>Invitations</th>
          <th>Inbody Scans</th>
          <th>Private Sessions</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody id="subscriptions-tbody"></tbody>
      </table>
    </div>

    <div class="section" id="member_benefits">
  <h1>Member Benefits</h1>
  <table>
    <thead>
      <tr>
        <th>Member ID</th>
        <th>Name</th>
        <th>Freeze Days Left</th>
        <th>Invitations Left</th>
        <th>Inbody Scans Left</th>
        <th>Private Sessions Left</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="member-benefits-tbody"></tbody>
  </table>
</div>


    <div class="section" id="messages">
      <h1>Messages</h1>
      <table>
        <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Date</th>
          <th>Message</th>
        </tr>
        </thead>
        <tbody id="messages-tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<div id="modal" class="modal" onclick="if(event.target===this) closeModal()">
  <div class="modal-content" id="modal-content">
    <h3 id="modal-title"></h3>
    <div class="form-grid" id="modal-form"></div>
    <div class="actions" id="modal-actions">
      <button class="small-btn" id="modal-save-btn" onclick="saveModal()">Save</button>
      <button class="small-btn" onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<div id="info-modal" class="modal" onclick="if(event.target===this) closeInfo()">
  <div class="modal-content" id="info-content">
    <h3 id="info-title"></h3>
    <div id="info-body" class="info-list"></div>
    <div style="margin-top:12px;">
      <button class="small-btn" onclick="closeInfo()">Close</button>
    </div>
  </div>
</div>

<script>
let members = [];
let trainers = [];
let classes = [];
let payment = [];
let equipment = [];
let gyms = [];
let staff = [];
let messages = [];
let subscriptions = [];
let memberBenefits = [];


async function loadMemberBenefits() {
  try {
    const res = await fetch('api.php?entity=member_benefits&action=list');
    const data = await res.json();
    if (!Array.isArray(data)) return;
    memberBenefits = data;
    renderMemberBenefits();
  } catch (err) {
    console.error(err);
    alert('Error loading member benefits');
  }
}

function renderMemberBenefits() {
  const tbody = document.getElementById('member-benefits-tbody');
  if (!tbody) return;
  tbody.innerHTML = "";
  memberBenefits.forEach((b, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${b.member_id}</td>
      <td>${b.name}</td>
      <td>${b.freeze_days_left}</td>
      <td>${b.invitations_left}</td>
      <td>${b.inbody_scans_left}</td>
      <td>${b.private_sessions_left}</td>
      <td class="actions">
        <button class="small-btn" onclick="editMemberBenefits(${i})">Edit</button>
        <button class="small-btn" onclick="deleteMemberBenefits(${i})">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
}


function editMemberBenefits(i) {
  const b = memberBenefits[i];
  if (!b) return;

  showModal("Edit Member Benefits", [
    { label: "Member ID",             id: "member_id",             type: "number", value: b.member_id },
    { label: "Freeze Days Left",      id: "freeze_days_left",      type: "number", value: b.freeze_days_left },
    { label: "Invitations Left",      id: "invitations_left",      type: "number", value: b.invitations_left },
    { label: "Inbody Scans Left",     id: "inbody_scans_left",     type: "number", value: b.inbody_scans_left },
    { label: "Private Sessions Left", id: "private_sessions_left", type: "number", value: b.private_sessions_left }
  ], async (data) => {
    data.member_id = parseInt(data.member_id, 10);

    const res = await fetch("api.php?entity=member_benefits&action=update", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }

    const updated = json.benefits;
    const idx = memberBenefits.findIndex(x => x.member_id == updated.member_id);
    if (idx >= 0) memberBenefits[idx] = updated;
    renderMemberBenefits();
    closeModal();
  });
}

function deleteMemberBenefits(i) {
  const b = memberBenefits[i];
  if (!b) return;
  if (!confirm("Delete benefits for this member?")) return;

  fetch('api.php?entity=member_benefits&action=delete', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ member_id: b.member_id })
  })
  .then(r => r.json())
  .then(json => {
    if (!json.success) { alert(json.error || 'Error'); return; }
    memberBenefits.splice(i, 1);
    renderMemberBenefits();
  })
  .catch(err => {
    console.error(err);
    alert('Network error');
  });
}



function genId(prefix) {
  return prefix + "-" + Date.now().toString(36) + "-" + Math.floor(Math.random() * 9000 + 1000);
}

document.querySelectorAll(".sidebar a[data-section]").forEach(a => {
  a.addEventListener("click", function (e) {
    e.preventDefault();
    document.querySelectorAll(".sidebar a").forEach(link => link.classList.remove("active"));
    this.classList.add("active");
    const section = this.dataset.section;
    document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
    const el = document.getElementById(section);
    if (el) el.classList.add("active");
    document.getElementById("top-title").innerText = section;
  });
});


function renderMembers() {
  const tbody = document.getElementById("members-tbody");
  tbody.innerHTML = "";
  members.forEach((m, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${m.name}</td>
      <td>${m.age ?? ""}</td>
      <td>${m.gym_id ?? ""}</td>
      <td>${m.subscription_id || ""}</td>
      <td>${m.start_date || ""}</td>
      <td>${m.end_date || ""}</td>
       <td>${m.gmail || ""}</td>          
      <td>${m.phone_number || ""}</td>   
      <td>${m.member_id}</td>
      <td class="actions">
        <button class="small-btn" onclick="editMember(${i})">Edit</button>
        <button class="small-btn" onclick="deleteMember(${i})">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("total-members").innerText = members.length;
}

async function loadMembers() {
  try {
    const res = await fetch('api.php?entity=members&action=list');
    members = await res.json();
    renderMembers();
  } catch (err) {
    console.error(err);
    alert('Error loading members');
  }
}

function showAddMember() {
  showModal("Add Member", [
    { label: "Name",          id: "name",          type: "text" },
    { label: "Phone number",  id: "phone_number", type: "text" },
    { label: "Email gmail",   id: "gmail",        type: "text" },
    { label: "Age",           id: "age",          type: "text" },
    {
      label: "Gym",
      id: "gym_id",
      type: "select",
      options: gyms.map(g => ({
        value: g.gym_id,
        label: `${g.gym_id} - ${g.name}`
      }))
    },
    {
      label: "Subscription",
      id: "subscription_id",
      type: "select",
      options: subscriptions.map(s => ({
        value: s.subscription_id,
        label: `${s.subscription_id} - ${s.name}`
      }))
    },
    { label: "Start Date",    id: "start_date",   type: "date" },
    { label: "End Date",      id: "end_date",     type: "date" }
  ], async (data) => {
    const res = await fetch("api.php?entity=members&action=add", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }
    members.push(json.member);
    renderMembers();
    closeModal();
  });
}

function editMember(i) {
  const m = members[i];
  showModal("Edit Member", [
    { label: "Name",          id: "name",          type: "text", value: m.name },
    { label: "Phone number",  id: "phone_number", type: "text", value: m.phone_number },
    { label: "Email gmail",   id: "gmail",        type: "text", value: m.gmail },
    { label: "Age",           id: "age",          type: "text", value: m.age },
    {
      label: "Gym",
      id: "gym_id",
      type: "select",
      options: gyms.map(g => ({
        value: g.gym_id,
        label: `${g.gym_id} - ${g.name}`
      })),
      value: m.gym_id
    },
    {
      label: "Subscription",
      id: "subscription_id",
      type: "select",
      options: subscriptions.map(s => ({
        value: s.subscription_id,
        label: `${s.subscription_id} - ${s.name}`
      })),
      value: m.subscription_id
    },
    { label: "Start Date",    id: "start_date",   type: "date", value: m.start_date },
    { label: "End Date",      id: "end_date",     type: "date", value: m.end_date }
  ], async (data) => {
    data.member_id = m.member_id;
    const res = await fetch("api.php?entity=members&action=update", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }
    members[i] = json.member;
    renderMembers();
    closeModal();
  });
}

function deleteMember(i) {
  const m = members[i];
  if (!confirm("Delete this member?")) return;

  fetch('api.php?entity=members&action=delete', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ member_id: m.member_id })
  })
  .then(r => r.json())
  .then(json => {
    if (!json.success) { alert(json.error || 'Error'); return; }
    members.splice(i, 1);
    renderMembers();
  })
  .catch(err => {
    console.error(err);
    alert('Network error');
  });
}


function renderStaff() {
  const tbody = document.getElementById("staff-tbody");
  tbody.innerHTML = "";
  staff.forEach((s, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${s.staff_id}</td>
      <td>${s.name}</td>
      <td>${s.role}</td>
      <td>${s.phone_number}</td>
      <td>${s.email}</td>
      <td>${s.start_time || ""}</td>
      <td>${s.salary || ""}</td>
      <td>${s.gym_id || ""}</td>
      <td class="actions">
        <button class="small-btn" onclick="editStaff(${i})">Edit</button>
        <button class="small-btn" onclick="deleteStaff(${i})">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("total-staff").innerText = staff.length;
}

async function loadStaff() {
  try {
    const res = await fetch('api.php?entity=staff&action=list');
    staff = await res.json();
    renderStaff();
  } catch (err) {
    console.error(err);
    alert('Error loading staff');
  }
}

function showAddStaff() {
  showModal("Add Staff", [
    { label: "Name",  id: "name",  type: "text" },
    { label: "Role",  id: "role",  type: "text" },
    { label: "Phone", id: "phone", type: "text" },
    { label: "Email", id: "email", type: "text" },
    { label: "Start Time", id: "start_time", type: "datetime-local" },
    { label: "Salary", id: "salary", type: "text" },
    {
      label: "Gym",
      id: "gym_id",
      type: "select",
      options: gyms.map(g => ({
        value: g.gym_id,
        label: `${g.gym_id} - ${g.name}`
      }))
    }
  ], async (data) => {
    const res = await fetch("api.php?entity=staff&action=add", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }
    staff.push(json.staff);
    renderStaff();
    closeModal();
  });
}

function editStaff(i) {
  const s = staff[i];
  showModal("Edit Staff", [
    { label: "Name",  id: "name",  type: "text", value: s.name },
    { label: "Role",  id: "role",  type: "text", value: s.role },
    { label: "Phone", id: "phone", type: "text", value: s.phone_number },
    { label: "Email", id: "email", type: "text", value: s.email },
    { label: "Start Time", id: "start_time", type: "datetime-local", value: s.start_time },
    { label: "Salary", id: "salary", type: "text", value: s.salary },
    {
      label: "Gym",
      id: "gym_id",
      type: "select",
      options: gyms.map(g => ({
        value: g.gym_id,
        label: `${g.gym_id} - ${g.name}`
      })),
      value: s.gym_id
    }
  ], async (data) => {
    data.staff_id = s.staff_id;
    const res = await fetch("api.php?entity=staff&action=update", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }
    staff[i] = json.staff;
    renderStaff();
    closeModal();
  });
}

function deleteStaff(i) {
  const s = staff[i];
  if (!confirm("Delete this staff member?")) return;

  fetch('api.php?entity=staff&action=delete', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ staff_id: s.staff_id })
  })
  .then(r => r.json())
  .then(json => {
    if (!json.success) { alert(json.error || 'Error'); return; }
    staff.splice(i, 1);
    renderStaff();
  })
  .catch(err => {
    console.error(err);
    alert('Network error');
  });
}


function renderTrainer() {
  const tbody = document.getElementById("trainers-tbody");
  tbody.innerHTML = "";
  trainers.forEach((t, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${t.trainer_id}</td>
      <td>${t.trainer_name}</td>
      <td>${t.phone_number}</td>
      <td>${t.email || ""}</td>
      <td>${t.start_time || ""}</td>
      <td>${t.salary || ""}</td>
      <td>${t.gym_id}</td>
      <td class="actions">
        <button class="small-btn" onclick="showInfo('trainer', '${t.trainer_id}')">Info</button>
        <button class="small-btn" onclick="editTrainer(${i})">Edit</button>
        <button class="small-btn" onclick="deleteTrainer(${i})">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("total-trainers").innerText = trainers.length;
}

async function loadTrainer() {
  try {
    const res = await fetch('api.php?entity=trainer&action=list');
    trainers = await res.json();
    renderTrainer();
  } catch (err) {
    console.error(err);
    alert('Error loading trainer');
  }
}

function showAddTrainer() {
  showModal("Add Trainer", [
    { label: "Name",  id: "trainer_name", type: "text" },
    { label: "Phone", id: "phone_number", type: "text" },
    { label: "Email", id: "email",        type: "text" },
    { label: "Start Time", id: "start_time", type: "datetime-local" },
    { label: "Salary", id: "salary", type: "text" },
    {
      label: "Gym",
      id: "gym_id",
      type: "select",
      options: gyms.map(g => ({
        value: g.gym_id,
        label: `${g.gym_id} - ${g.name}`
      }))
    }
  ], async (data) => {
    const res = await fetch("api.php?entity=trainer&action=add", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }
    trainers.push(json.trainer);
    renderTrainer();
    closeModal();
  });
}

function editTrainer(i) {
  const t = trainers[i];
  showModal("Edit Trainer", [
    { label: "Name",  id: "trainer_name", type: "text", value: t.trainer_name },
    { label: "Phone", id: "phone_number", type: "text", value: t.phone_number },
    { label: "Email", id: "email",        type: "text", value: t.email },
    { label: "Start Time", id: "start_time", type: "datetime-local", value: t.start_time },
    { label: "Salary", id: "salary", type: "text", value: t.salary },
    {
      label: "Gym",
      id: "gym_id",
      type: "select",
      options: gyms.map(g => ({
        value: g.gym_id,
        label: `${g.gym_id} - ${g.name}`
      })),
      value: t.gym_id
    }
  ], async (data) => {
    data.trainer_id = t.trainer_id;
    const res = await fetch("api.php?entity=trainer&action=update", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }
    trainers[i] = json.trainer;
    renderTrainer();
    closeModal();
  });
}

function deleteTrainer(i) {
  const t = trainers[i];
  if (!confirm("Delete this trainer?")) return;

  fetch('api.php?entity=trainer&action=delete', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ trainer_id: t.trainer_id })
  })
  .then(r => r.json())
  .then(json => {
    if (!json.success) { alert(json.error || 'Error'); return; }
    trainers.splice(i, 1);
    renderTrainer();
  })
  .catch(err => {
    console.error(err);
    alert('Network error');
  });
}


function getTrainerNameById(trId) {
  const t = trainers.find(x => String(x.trainer_id) === String(trId));
  return t ? t.trainer_name : "";
}

function renderClasses() {
  const tbody = document.getElementById("classes-tbody");
  tbody.innerHTML = "";
  classes.forEach((c, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${c.class_id}</td>
      <td>${c.class_name}</td>
      <td>${getTrainerNameById(c.trainer_id)}</td>
      <td>${c.gym_id ?? ""}</td>
      <td>${c.schedule}</td>
      <td class="actions">
        <button class="small-btn" onclick="editClass(${i})">Edit</button>
        <button class="small-btn" onclick="deleteClass(${i})">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("total-classes").innerText = classes.length;
}

async function loadClasses() {
  try {
    const res = await fetch('api.php?entity=class&action=list');
    classes = await res.json();
    renderClasses();
  } catch (err) {
    console.error(err);
    alert('Error loading classes');
  }
}

function showAddClass() {
  showModal("Add Class", [
    { label: "Class name", id: "class_name", type: "text" },
    { label: "Schedule",   id: "schedule",   type: "text" },
    {
      label: "Trainer",
      id: "trainer_id",
      type: "select",
      options: trainers.map(t => ({
        value: t.trainer_id,
        label: `${t.trainer_id} - ${t.trainer_name}`
      }))
    },
    {
      label: "Gym",
      id: "gym_id",
      type: "select",
      options: gyms.map(g => ({
        value: g.gym_id,
        label: `${g.gym_id} - ${g.name}`
      }))
    }
  ], async (data) => {
    const res = await fetch("api.php?entity=class&action=add", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }
    classes.push(json.class);
    renderClasses();
    closeModal();
  });
}

function editClass(i) {
  const c = classes[i];
  showModal("Edit Class", [
    { label: "Class name", id: "class_name", type: "text", value: c.class_name },
    { label: "Schedule",   id: "schedule",   type: "text", value: c.schedule },
    {
      label: "Trainer",
      id: "trainer_id",
      type: "select",
      options: trainers.map(t => ({
        value: t.trainer_id,
        label: `${t.trainer_id} - ${t.trainer_name}`
      })),
      value: c.trainer_id
    },
    {
      label: "Gym",
      id: "gym_id",
      type: "select",
      options: gyms.map(g => ({
        value: g.gym_id,
        label: `${g.gym_id} - ${g.name}`
      })),
      value: c.gym_id
    }
  ], async (data) => {
    data.class_id = c.class_id;
    const res = await fetch("api.php?entity=class&action=update", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }
    classes[i] = json.class;
    renderClasses();
    closeModal();
  });
}

function deleteClass(i) {
  const c = classes[i];
  if (!confirm("Delete this class?")) return;

  fetch('api.php?entity=class&action=delete', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ class_id: c.class_id })
  })
  .then(r => r.json())
  .then(json => {
    if (!json.success) { alert(json.error || 'Error'); return; }
    classes.splice(i, 1);
    renderClasses();
  })
  .catch(err => {
    console.error(err);
    alert('Network error');
  });
}


function getMemberNameById(mId) {
  const m = members.find(x => String(x.member_id) === String(mId));
  return m ? m.name : "";
}

function renderPayment() {
  const tbody = document.getElementById("payments-tbody");
  tbody.innerHTML = "";
  payment.forEach((p, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${p.payment_id}</td>
      <td>${getMemberNameById(p.member_id) || p.member_id}</td>
      <td>${p.amount}</td>
      <td>${p.date}</td>
      <td class="actions">
        <button class="small-btn" onclick="editPayment(${i})">Edit</button>
        <button class="small-btn" onclick="deletePayment(${i})">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("total-payments").innerText = payment.length;
}

async function loadPayment() {
  try {
    const res = await fetch('api.php?entity=payment&action=list');
    payment = await res.json();
    renderPayment();
  } catch (err) {
    console.error(err);
    alert('Error loading payments');
  }
}

function showAddPayment() {
  showModal("Add Payment", [
    {
      label: "Member",
      id: "member_id",
      type: "select",
      options: members.map(m => ({
        value: m.member_id,
        label: `${m.member_id} - ${m.name}`
      }))
    },
    { label: "Amount", id: "amount", type: "text" },
    { label: "Date",   id: "date",   type: "date" }
  ], async (data) => {
    const res = await fetch("api.php?entity=payment&action=add", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }
    payment.push(json.payment);
    renderPayment();
    closeModal();
  });
}

function editPayment(i) {
  const p = payment[i];
  showModal("Edit Payment", [
    {
      label: "Member",
      id: "member_id",
      type: "select",
      options: members.map(m => ({
        value: m.member_id,
        label: `${m.member_id} - ${m.name}`
      })),
      value: p.member_id
    },
    { label: "Amount", id: "amount", type: "text", value: p.amount },
    { label: "Date",   id: "date",   type: "date", value: p.date }
  ], async (data) => {
    data.payment_id = p.payment_id;
    const res = await fetch("api.php?entity=payment&action=update", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }
    payment[i] = json.payment;
    renderPayment();
    closeModal();
  });
}

function deletePayment(i) {
  const p = payment[i];
  if (!confirm("Delete this payment?")) return;

  fetch('api.php?entity=payment&action=delete', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ payment_id: p.payment_id })
  })
  .then(r => r.json())
  .then(json => {
    if (!json.success) { alert(json.error || 'Error'); return; }
    payment.splice(i, 1);
    renderPayment();
  })
  .catch(err => {
    console.error(err);
    alert('Network error');
  });
}


function renderEquipment() {
  const tbody = document.getElementById("equipment-tbody");
  tbody.innerHTML = "";
  equipment.forEach((e, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${e.equipment_id}</td>
      <td>${e.name}</td>
      <td>${e.type ?? ""}</td>
      <td>${e.status}</td>
      <td>${e.purchase_date ?? ""}</td>
      <td>${e.gym_id ?? ""}</td>
      <td class="actions">
        <button class="small-btn" onclick="editEquipment(${i})">Edit</button>
        <button class="small-btn" onclick="deleteEquipment(${i})">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("total-equipment").innerText = equipment.length;
}

async function loadEquipment() {
  try {
    const res = await fetch('api.php?entity=equipment&action=list');
    equipment = await res.json();
    renderEquipment();
  } catch (err) {
    console.error(err);
    alert('Error loading equipment');
  }
}

function showAddEquipment() {
  showModal("Add Equipment", [
    { label: "Name",          id: "name",          type: "text" },
    { label: "Type",          id: "type",          type: "text" },
    { label: "Status",        id: "status",        type: "text" },
    { label: "Purchase Date", id: "purchase_date", type: "date" },
    {
      label: "Gym",
      id: "gym_id",
      type: "select",
      options: gyms.map(g => ({
        value: g.gym_id,
        label: `${g.gym_id} - ${g.name}`
      }))
    }
  ], async (data) => {
    const res = await fetch("api.php?entity=equipment&action=add", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }
    equipment.push(json.equipment);
    renderEquipment();
    closeModal();
  });
}

function editEquipment(i) {
  const e = equipment[i];
  showModal("Edit Equipment", [
    { label: "Name",          id: "name",          type: "text", value: e.name },
    { label: "Type",          id: "type",          type: "text", value: e.type },
    { label: "Status",        id: "status",        type: "text", value: e.status },
    { label: "Purchase Date", id: "purchase_date", type: "date", value: e.purchase_date },
    {
      label: "Gym",
      id: "gym_id",
      type: "select",
      options: gyms.map(g => ({
        value: g.gym_id,
        label: `${g.gym_id} - ${g.name}`
      })),
      value: e.gym_id
    }
  ], async (data) => {
    data.equipment_id = e.equipment_id;
    const res = await fetch("api.php?entity=equipment&action=update", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || "Error"); return; }
    equipment[i] = json.equipment;
    renderEquipment();
    closeModal();
  });
}

function deleteEquipment(i) {
  const e = equipment[i];
  if (!confirm("Delete this equipment?")) return;

  fetch('api.php?entity=equipment&action=delete', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ equipment_id: e.equipment_id })
  })
  .then(r => r.json())
  .then(json => {
    if (!json.success) { alert(json.error || 'Error'); return; }
    equipment.splice(i, 1);
    renderEquipment();
  })
  .catch(err => {
    console.error(err);
    alert('Network error');
  });
}


async function loadGyms() {
  try {
    const res = await fetch('api.php?entity=gym&action=list');
    gyms = await res.json();
    renderGyms();
  } catch (err) {
    console.error(err);
    alert('Error loading gyms');
  }
}

function renderGyms() {
  const tbody = document.getElementById("gyms-tbody");
  tbody.innerHTML = "";
  gyms.forEach((g, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${g.gym_id}</td>
      <td>${g.name}</td>
      <td>${g.gym_phone}</td>
      <td class="actions">
        <button class="small-btn" onclick="editGym(${i})">Edit</button>
        <button class="small-btn" onclick="deleteGym(${i})">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function showAddGym() {
  showModal("Add Gym", [
    { label: "Name",      id: "name",      type: "text" },
    { label: "Address",   id: "address",   type: "text" },
    { label: "Gym phone", id: "gym_phone", type: "text" }
  ], async (data) => {
    const res = await fetch('api.php?entity=gym&action=add', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || 'Error'); return; }
    gyms.push(json.gym);
    renderGyms();
    closeModal();
  });
}

function editGym(i) {
  const g = gyms[i];
  showModal("Edit Gym", [
    { label: "Name",      id: "name",      type: "text", value: g.name },
    { label: "Address",   id: "address",   type: "text", value: g.address },
    { label: "Gym phone", id: "gym_phone", type: "text", value: g.gym_phone }
  ], async (data) => {
    data.gym_id = g.gym_id;
    const res = await fetch('api.php?entity=gym&action=update', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || 'Error'); return; }
    gyms[i] = json.gym;
    renderGyms();
    closeModal();
  });
}

function deleteGym(i) {
  const g = gyms[i];
  if (!confirm("Delete this gym?")) return;

  fetch('api.php?entity=gym&action=delete', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ gym_id: g.gym_id })
  })
  .then(r => r.json())
  .then(json => {
    if (!json.success) { alert(json.error || 'Error'); return; }
    gyms.splice(i, 1);
    renderGyms();
  })
  .catch(err => {
    console.error(err);
    alert('Network error');
  });
}


function renderSubscriptions() {
  const tbody = document.getElementById("subscriptions-tbody");
  tbody.innerHTML = "";
  subscriptions.forEach((s, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${s.subscription_id}</td>
      <td>${s.name}</td>
      <td>${s.price}</td>
      <td>${s.max_freeze_days}</td>
      <td>${s.max_invitations}</td>
      <td>${s.max_inbody_scans}</td>
      <td>${s.max_private_sessions}</td>
      <td class="actions">
        <button class="small-btn" onclick="editSubscription(${i})">Edit</button>
        <button class="small-btn" onclick="deleteSubscription(${i})">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

async function loadSubscriptions() {
  try {
    const res = await fetch('api.php?entity=subscriptions&action=list');
    subscriptions = await res.json();
    renderSubscriptions();
  } catch (err) {
    console.error(err);
    alert('Error loading subscriptions');
  }
}

function showAddSubscription() {
  showModal("Add Subscription", [
    { label: "Name",                 id: "name",                 type: "text" },
    { label: "Price",                id: "price",                type: "text" },
    { label: "Max freeze days",      id: "max_freeze_days",      type: "text" },
    { label: "Max invitations",      id: "max_invitations",      type: "text" },
    { label: "Max inbody scans",     id: "max_inbody_scans",     type: "text" },
    { label: "Max private sessions", id: "max_private_sessions", type: "text" }
  ], async (data) => {
    const res = await fetch('api.php?entity=subscriptions&action=add', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || 'Error'); return; }
    subscriptions.push(json.subscription);
    renderSubscriptions();
    closeModal();
  });
}

function editSubscription(i) {
  const s = subscriptions[i];
  showModal("Edit Subscription", [
    { label: "Name",                 id: "name",                 type: "text", value: s.name },
    { label: "Price",                id: "price",                type: "text", value: s.price },
    { label: "Max freeze days",      id: "max_freeze_days",      type: "text", value: s.max_freeze_days },
    { label: "Max invitations",      id: "max_invitations",      type: "text", value: s.max_invitations },
    { label: "Max inbody scans",     id: "max_inbody_scans",     type: "text", value: s.max_inbody_scans },
    { label: "Max private sessions", id: "max_private_sessions", type: "text", value: s.max_private_sessions }
  ], async (data) => {
    data.subscription_id = s.subscription_id;
    const res = await fetch('api.php?entity=subscriptions&action=update', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });
    const json = await res.json();
    if (!json.success) { alert(json.error || 'Error'); return; }
    subscriptions[i] = json.subscription;
    renderSubscriptions();
    closeModal();
  });
}

function deleteSubscription(i) {
  const s = subscriptions[i];
  if (!confirm("Delete this subscription?")) return;

  fetch('api.php?entity=subscriptions&action=delete', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ subscription_id: s.subscription_id })
  })
  .then(r => r.json())
  .then(json => {
    if (!json.success) { alert(json.error || 'Error'); return; }
    subscriptions.splice(i, 1);
    renderSubscriptions();
  })
  .catch(err => {
    console.error(err);
    alert('Network error');
  });
}


function renderMessages() {
  const tbody = document.getElementById("messages-tbody");
  tbody.innerHTML = "";
  messages.forEach((m, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${m.name}</td>
      <td>${m.email}</td>
      <td>${m.phone_number}</td>
      <td>${m.date || ""}</td>
      <td>${m.message}</td>
      <td class="actions">
        <button class="small-btn" onclick="deleteMessage(${i})">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

async function loadMessages() {
  try {
    const res = await fetch('api.php?entity=contact&action=list');
    messages = await res.json();
    renderMessages();
  } catch (err) {
    console.error(err);
    alert('Error loading messages');
  }
}

function deleteMessage(i) {
  const m = messages[i];
  if (!confirm("Delete this message?")) return;

  fetch('api.php?entity=contact&action=delete', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ contact_id: m.contact_id })
  })
  .then(r => r.json())
  .then(json => {
    if (!json.success) { alert(json.error || 'Error'); return; }
    messages.splice(i, 1);
    renderMessages();
  })
  .catch(err => {
    console.error(err);
    alert('Network error');
  });
}


let modalSaveCallback = null;

function showModal(title, fields, saveCallback) {
  modalSaveCallback = saveCallback;
  document.getElementById("modal-title").innerText = title;
  const form = document.getElementById("modal-form");
  form.innerHTML = "";
  fields.forEach(f => {
    const wrap = document.createElement("div");
    const label = document.createElement("label");
    label.innerText = f.label;
    wrap.appendChild(label);
    let input;
    if (f.type === "select") {
      input = document.createElement("select");
      (f.options || []).forEach(o => {
        const opt = document.createElement("option");
        opt.value = (o.value ?? o);
        opt.text = (o.label ?? o);
        input.appendChild(opt);
      });
      if (f.value != null) input.value = f.value;
    } else {
      input = document.createElement("input");
      input.type = f.type || "text";
      if (f.value != null) input.value = f.value;
      if (f.placeholder) input.placeholder = f.placeholder;
    }
    input.id = f.id;
    wrap.appendChild(input);
    form.appendChild(wrap);
  });
  document.getElementById("modal").style.display = "flex";
}

function saveModal() {
  const inputs = document
    .getElementById("modal-form")
    .querySelectorAll("input,select");
  const data = {};
  inputs.forEach(i => (data[i.id] = i.value));
  if (modalSaveCallback) modalSaveCallback(data);
}


function closeModal() {
  document.getElementById("modal").style.display = "none";
  document.getElementById("modal-form").innerHTML = "";
  modalSaveCallback = null;
}

function showInfo(section, id) {
  let item = null;
  switch (section) {
    case "members":       item = members.find(x => String(x.member_id) === String(id));        break;
    case "staff":         item = staff.find(x => String(x.staff_id) === String(id));          break;
    case "trainer":       item = trainers.find(x => String(x.trainer_id) === String(id));      break;
    case "classes":       item = classes.find(x => String(x.class_id) === String(id));         break;
    case "payments":      item = payment.find(x => x.payment_id === id || String(x.payment_id) === String(id)); break;
    case "equipment":     item = equipment.find(x => String(x.equipment_id) === String(id));   break;
    case "gyms":          item = gyms.find(x => String(x.gym_id) === String(id));             break;
    case "subscriptions": item = subscriptions.find(x => String(x.subscription_id) === String(id)); break;
    case "messages":      item = messages[Number(id)];                                        break;
  }
  if (!item) { alert("Item not found"); return; }

  document.getElementById("info-title").innerText = "Details: " + section;
  const body = document.getElementById("info-body");
  body.innerHTML = "";
  Object.keys(item).forEach(k => {
    const row = document.createElement("div");
    row.className = "info-row";
    const label = document.createElement("div");
    label.className = "info-label";
    label.innerText = k;
    const val = document.createElement("div");
    val.className = "info-value";
    val.innerText = item[k] ?? "";
    row.appendChild(label);
    row.appendChild(val);
    body.appendChild(row);
  });
  document.getElementById("info-modal").style.display = "flex";
}

function closeInfo() {
  document.getElementById("info-modal").style.display = "none";
  document.getElementById("info-body").innerHTML = "";
}

async function performSearch() {
  const box = document.getElementById("search-input");
  if (!box) return;

  const q = box.value.trim();
  const activeLink = document.querySelector(".sidebar a.active");
  const section = activeLink ? activeLink.dataset.section : "members";

  if (!q) {
    switch (section) {
      case "members":       loadMembers();       break;
      case "staff":         loadStaff();         break;
      case "trainers":      loadTrainer();       break;
      case "classes":       loadClasses();       break;
      case "payments":      loadPayment();       break;
      case "equipment":     loadEquipment();     break;
      case "gyms":          loadGyms();          break;
      case "subscriptions": loadSubscriptions(); break;
      case "messages":      loadMessages();      break;
    }
    return;
  }

  let entity = "members";
  let renderFn = renderMembers;

  switch (section) {
    case "members":       entity = "members";       renderFn = renderMembers;       break;
    case "staff":         entity = "staff";         renderFn = renderStaff;         break;
    case "trainers":      entity = "trainer";       renderFn = renderTrainer;       break;
    case "classes":       entity = "class";         renderFn = renderClasses;       break;
    case "payments":      entity = "payment";       renderFn = renderPayment;       break;
    case "equipment":     entity = "equipment";     renderFn = renderEquipment;     break;
    case "gyms":          entity = "gym";           renderFn = renderGyms;          break;
    case "subscriptions": entity = "subscriptions"; renderFn = renderSubscriptions; break;
    case "messages":      entity = "contact";       renderFn = renderMessages;      break;
  }

  try {
    const res = await fetch(`api.php?entity=${entity}&action=search`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query: q })
    });
    const data = await res.json();
    if (!Array.isArray(data)) {
      alert(data.error || "Search error");
      return;
    }

    switch (entity) {
      case "members":       members       = data; break;
      case "staff":         staff         = data; break;
      case "trainer":       trainers      = data; break;
      case "class":         classes       = data; break;
      case "payment":       payment       = data; break;
      case "equipment":     equipment     = data; break;
      case "gym":           gyms          = data; break;
      case "subscriptions": subscriptions = data; break;
      case "contact":       messages      = data; break;
    }
    renderFn();
  } catch (err) {
    console.error(err);
    alert("Network error");
  }
}



function showNotifications() { alert("No notifications"); }
function goHome() { window.location.href = "index.html"; }


loadGyms();
loadMembers();
loadStaff();
loadSubscriptions();
loadPayment();
loadTrainer();
loadClasses();
loadEquipment();
loadMessages();
loadMemberBenefits();


const searchBox = document.getElementById("search-input");
const searchBtn = document.getElementById("search-btn");

if (searchBtn) {
  searchBtn.addEventListener("click", performSearch);
}
if (searchBox) {
  searchBox.addEventListener("keyup", e => {
    if (e.key === "Enter") performSearch();
  });
}
</script>
</body>
</html>